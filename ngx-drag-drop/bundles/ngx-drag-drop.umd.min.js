!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-drag-drop",["exports","@angular/core","@angular/common"],t):t(e["ngx-drag-drop"]={},e.ng.core,e.ng.common)}(this,function(e,a,t){"use strict";var l=["move","copy","link"],p="application/x-dnd",f="application/json",g="Text";function i(e){return e.substr(0,p.length)===p}function o(e){if(e.dataTransfer){var t=e.dataTransfer.types;if(!t)return g;for(var n=0;n<t.length;n++)if(t[n]===g||t[n]===f||i(t[n]))return t[n]}return null}function u(e,t){return"all"===t||"uninitialized"===t?e:e.filter(function(e){return-1!==t.toLowerCase().indexOf(e)})}function d(e,t){var n=window.getComputedStyle(t),r=parseFloat(n.paddingTop)||0,a=parseFloat(n.paddingLeft)||0,d=parseFloat(n.borderTopWidth)||0,i=parseFloat(n.borderLeftWidth)||0;return{x:e.offsetX+a+i,y:e.offsetY+r+d}}var c={isDragging:!1,dropEffect:"none",effectAllowed:"all",type:undefined};function r(){c.isDragging=!1,c.dropEffect=undefined,c.effectAllowed=undefined,c.type=undefined}function s(e,t){!0===c.isDragging&&(c.dropEffect=t),e.dataTransfer.dropEffect=t}function h(e,t){var n=e.dataTransfer?e.dataTransfer.effectAllowed:"uninitialized",r=u(l,n);return!0===c.isDragging&&(r=u(r,c.effectAllowed)),t&&(r=u(r,t)),0===r.length?"none":e.ctrlKey&&-1!==r.indexOf("copy")?"copy":e.altKey&&-1!==r.indexOf("link")?"link":r[0]}function D(e){if(!0===c.isDragging)return c.type;var t=o(e);return null===t?undefined:t===g||t===f?undefined:t.substr(p.length+1)||undefined}function v(){return!1===c.isDragging}var m=c,n=function(){function e(e,t){e.registerDragImage(t)}return e.decorators=[{type:a.Directive,args:[{selector:"[dndDragImageRef]"}]}],e.ctorParameters=function(){return[{type:y},{type:a.ElementRef}]},e}(),y=function(){function e(e,t,n){var r=this;this.elementRef=e,this.renderer=t,this.ngZone=n,this.dndEffectAllowed="copy",this.dndDraggingClass="dndDragging",this.dndDraggingSourceClass="dndDraggingSource",this.dndDraggableDisabledClass="dndDraggableDisabled",this.dndDragImageOffsetFunction=d,this.dndStart=new a.EventEmitter,this.dndDrag=new a.EventEmitter,this.dndEnd=new a.EventEmitter,this.dndMoved=new a.EventEmitter,this.dndCopied=new a.EventEmitter,this.dndLinked=new a.EventEmitter,this.dndCanceled=new a.EventEmitter,this.draggable=!0,this.isDragStarted=!1,this.dragEventHandler=function(e){return r.onDrag(e)}}return Object.defineProperty(e.prototype,"dndDisableIf",{set:function(e){this.draggable=!e,this.draggable?this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass):this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dndDisableDragIf",{set:function(e){this.dndDisableIf=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.elementRef.nativeElement.addEventListener("drag",e.dragEventHandler)})},e.prototype.ngOnDestroy=function(){this.elementRef.nativeElement.removeEventListener("drag",this.dragEventHandler),!0===this.isDragStarted&&r()},e.prototype.onDragStart=function(e){var t=this;if(!1===this.draggable)return!1;if("undefined"!=typeof this.dndHandle&&"undefined"==typeof e._dndUsingHandle)return!1;!function r(e,t,n){c.isDragging=!0,c.dropEffect="none",c.effectAllowed=t,c.type=n,e.dataTransfer.effectAllowed=t}(e,this.dndEffectAllowed,this.dndType),this.isDragStarted=!0,function s(e,t,n){var r=p+(t.type?"-"+t.type:""),a=JSON.stringify(t);try{e.dataTransfer.setData(r,a)}catch(o){try{e.dataTransfer.setData(f,a)}catch(o){var d=u(l,n);e.dataTransfer.effectAllowed=d[0];try{if(window.clipboardData&&window.clipboardData.getData("Text"))var i=window.clipboardData.getData("Text")}catch(o){}e.dataTransfer.setData(g,a);try{window.clipboardData&&i&&window.clipboardData.setData("Text",i)}catch(o){}}}}(e,{data:this.dndDraggable,type:this.dndType},m.effectAllowed),this.dragImage=this.determineDragImage(),this.renderer.addClass(this.dragImage,this.dndDraggingClass),"undefined"==typeof this.dndDragImageElementRef&&"undefined"==typeof e._dndUsingHandle||function a(e,t,n){var r=n(e,t)||{x:0,y:0};e.dataTransfer.setDragImage(t,r.x,r.y)}(e,this.dragImage,this.dndDragImageOffsetFunction);var n=this.renderer.listen(this.elementRef.nativeElement,"drag",function(){t.renderer.addClass(t.elementRef.nativeElement,t.dndDraggingSourceClass),n()});this.dndStart.emit(e),e.stopPropagation()},e.prototype.onDrag=function(e){this.dndDrag.emit(e)},e.prototype.onDragEnd=function(e){var t,n=this;switch(m.dropEffect){case"copy":t=this.dndCopied;break;case"link":t=this.dndLinked;break;case"move":t=this.dndMoved;break;default:t=this.dndCanceled}t.emit(e),this.dndEnd.emit(e),r(),this.isDragStarted=!1,this.renderer.removeClass(this.dragImage,this.dndDraggingClass),window.setTimeout(function(){n.renderer.removeClass(n.elementRef.nativeElement,n.dndDraggingSourceClass)},0),e.stopPropagation()},e.prototype.registerDragHandle=function(e){this.dndHandle=e},e.prototype.registerDragImage=function(e){this.dndDragImageElementRef=e},e.prototype.determineDragImage=function(){return"undefined"!=typeof this.dndDragImageElementRef?this.dndDragImageElementRef.nativeElement:this.elementRef.nativeElement},e.decorators=[{type:a.Directive,args:[{selector:"[dndDraggable]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:a.Renderer2},{type:a.NgZone}]},e.propDecorators={dndDraggable:[{type:a.Input}],dndEffectAllowed:[{type:a.Input}],dndType:[{type:a.Input}],dndDraggingClass:[{type:a.Input}],dndDraggingSourceClass:[{type:a.Input}],dndDraggableDisabledClass:[{type:a.Input}],dndDragImageOffsetFunction:[{type:a.Input}],dndStart:[{type:a.Output}],dndDrag:[{type:a.Output}],dndEnd:[{type:a.Output}],dndMoved:[{type:a.Output}],dndCopied:[{type:a.Output}],dndLinked:[{type:a.Output}],dndCanceled:[{type:a.Output}],draggable:[{type:a.HostBinding,args:["attr.draggable"]}],dndDisableIf:[{type:a.Input}],dndDisableDragIf:[{type:a.Input}],onDragStart:[{type:a.HostListener,args:["dragstart",["$event"]]}],onDragEnd:[{type:a.HostListener,args:["dragend",["$event"]]}]},e}(),E=function(){function e(e){this.elementRef=e}return e.decorators=[{type:a.Directive,args:[{selector:"[dndPlaceholderRef]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef}]},e}(),b=function(){function e(e,t,n){var r=this;this.ngZone=e,this.elementRef=t,this.renderer=n,this.dndAllowExternal=!1,this.dndHorizontal=!1,this.dndDragoverClass="dndDragover",this.dndDropzoneDisabledClass="dndDropzoneDisabled",this.dndDragover=new a.EventEmitter,this.dndDrop=new a.EventEmitter,this.placeholder=null,this.disabled=!1,this.dragEnterEventHandler=function(e){return r.onDragEnter(e)},this.dragOverEventHandler=function(e){return r.onDragOver(e)},this.dragLeaveEventHandler=function(e){return r.onDragLeave(e)}}return Object.defineProperty(e.prototype,"dndDisableIf",{set:function(e){this.disabled=!!e,this.disabled?this.renderer.addClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass):this.renderer.removeClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dndDisableDropIf",{set:function(e){this.dndDisableIf=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this;this.placeholder=this.tryGetPlaceholder(),this.removePlaceholderFromDOM(),this.ngZone.runOutsideAngular(function(){e.elementRef.nativeElement.addEventListener("dragenter",e.dragEnterEventHandler),e.elementRef.nativeElement.addEventListener("dragover",e.dragOverEventHandler),e.elementRef.nativeElement.addEventListener("dragleave",e.dragLeaveEventHandler)})},e.prototype.ngOnDestroy=function(){this.elementRef.nativeElement.removeEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.removeEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.removeEventListener("dragleave",this.dragLeaveEventHandler)},e.prototype.onDragEnter=function(e){if(!0!==e._dndDropzoneActive){if("undefined"==typeof e._dndDropzoneActive){var t=document.elementFromPoint(e.clientX,e.clientY);this.elementRef.nativeElement.contains(t)&&(e._dndDropzoneActive=!0)}var n=D(e);!1!==this.isDropAllowed(n)&&e.preventDefault()}else this.cleanupDragoverState()},e.prototype.onDragOver=function(e){if(!e.defaultPrevented){var t=D(e);if(!1!==this.isDropAllowed(t)){this.checkAndUpdatePlaceholderPosition(e);var n=h(e,this.dndEffectAllowed);"none"!==n?(e.preventDefault(),s(e,n),this.dndDragover.emit(e),this.renderer.addClass(this.elementRef.nativeElement,this.dndDragoverClass)):this.cleanupDragoverState()}}},e.prototype.onDrop=function(e){try{var t=D(e);if(!1===this.isDropAllowed(t))return;var n=function d(e,t){var n=o(e);return!0===t?null!==n&&i(n)?JSON.parse(e.dataTransfer.getData(n)):{}:JSON.parse(e.dataTransfer.getData(n))}(e,v());if(!1===this.isDropAllowed(n.type))return;e.preventDefault();var r=h(e);if(s(e,r),"none"===r)return;var a=this.getPlaceholderIndex();if(-1===a)return;this.dndDrop.emit({event:e,dropEffect:r,isExternal:v(),data:n.data,index:a,type:t}),e.stopPropagation()}finally{this.cleanupDragoverState()}},e.prototype.onDragLeave=function(e){if("undefined"==typeof e._dndDropzoneActive){var t=document.elementFromPoint(e.clientX,e.clientY);if(this.elementRef.nativeElement.contains(t))return void(e._dndDropzoneActive=!0)}this.cleanupDragoverState(),s(e,"none")},e.prototype.isDropAllowed=function(e){if(!0===this.disabled)return!1;if(!0===v()&&!1===this.dndAllowExternal)return!1;if(!this.dndDropzone)return!0;if(!e)return!0;if(!1===Array.isArray(this.dndDropzone))throw new Error("dndDropzone: bound value to [dndDropzone] must be an array!");return-1!==this.dndDropzone.indexOf(e)},e.prototype.tryGetPlaceholder=function(){return"undefined"!=typeof this.dndPlaceholderRef?this.dndPlaceholderRef.elementRef.nativeElement:this.elementRef.nativeElement.querySelector("[dndPlaceholderRef]")},e.prototype.removePlaceholderFromDOM=function(){null!==this.placeholder&&null!==this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)},e.prototype.checkAndUpdatePlaceholderPosition=function(e){if(null!==this.placeholder){this.placeholder.parentNode!==this.elementRef.nativeElement&&this.renderer.appendChild(this.elementRef.nativeElement,this.placeholder);var t=function r(e,t){for(var n=t;n.parentNode!==e;){if(!n.parentNode)return null;n=n.parentNode}return n}(this.elementRef.nativeElement,e.target);if(null!==t&&t!==this.placeholder)(function a(e,t,n){var r=t.getBoundingClientRect();return n?e.clientX<r.left+r.width/2:e.clientY<r.top+r.height/2})(e,t,this.dndHorizontal)?t.previousSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,t):t.nextSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,t.nextSibling)}},e.prototype.getPlaceholderIndex=function(){if(null===this.placeholder)return undefined;var e=this.elementRef.nativeElement;return Array.prototype.indexOf.call(e.children,this.placeholder)},e.prototype.cleanupDragoverState=function(){this.renderer.removeClass(this.elementRef.nativeElement,this.dndDragoverClass),this.removePlaceholderFromDOM()},e.decorators=[{type:a.Directive,args:[{selector:"[dndDropzone]"}]}],e.ctorParameters=function(){return[{type:a.NgZone},{type:a.ElementRef},{type:a.Renderer2}]},e.propDecorators={dndDropzone:[{type:a.Input}],dndEffectAllowed:[{type:a.Input}],dndAllowExternal:[{type:a.Input}],dndHorizontal:[{type:a.Input}],dndDragoverClass:[{type:a.Input}],dndDropzoneDisabledClass:[{type:a.Input}],dndDragover:[{type:a.Output}],dndDrop:[{type:a.Output}],dndPlaceholderRef:[{type:a.ContentChild,args:[E]}],dndDisableIf:[{type:a.Input}],dndDisableDropIf:[{type:a.Input}],onDrop:[{type:a.HostListener,args:["drop",["$event"]]}]},e}(),w=function(){function e(e){this.draggable=!0,e.registerDragHandle(this)}return e.prototype.onDragEvent=function(e){e._dndUsingHandle=!0},e.decorators=[{type:a.Directive,args:[{selector:"[dndHandle]"}]}],e.ctorParameters=function(){return[{type:y}]},e.propDecorators={draggable:[{type:a.HostBinding,args:["attr.draggable"]}],onDragEvent:[{type:a.HostListener,args:["dragstart",["$event"]]},{type:a.HostListener,args:["dragend",["$event"]]}]},e}(),R=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{imports:[t.CommonModule],declarations:[y,b,w,E,n],exports:[y,b,w,E,n]}]}],e}();e.DndDragImageRefDirective=n,e.DndDraggableDirective=y,e.DndPlaceholderRefDirective=E,e.DndDropzoneDirective=b,e.DndHandleDirective=w,e.DndModule=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-drag-drop.umd.min.js.map